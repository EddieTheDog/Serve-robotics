<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #fff; padding: 30px; }
  .guest { border: 1px solid #ccc; padding: 16px; margin-bottom: 20px; border-radius: 8px; }
  button { margin: 6px; padding: 10px; font-size: 16px; cursor: pointer; }
  .guest h3 { margin: 4px 0; }
  .guest canvas { display: block; margin: 8px auto; }
</style>
</head>
<body>
<h1>Admin Dashboard</h1>
<div id="queue"></div>

<script>
async function loadQueue() {
  const res = await fetch("/api/queue");
  const guests = await res.json();
  const q = document.getElementById("queue");
  q.innerHTML = "";

  guests.forEach(g => {
    const div = document.createElement("div");
    div.className = "guest";

    div.innerHTML = `
      <h3>${g.first_name} ${g.last_name}</h3>
      <div id="qr-${g.id}"></div>
      <button onclick="setStatus('${g.id}','accepted')">Accept</button>
      <button onclick="setStatus('${g.id}','declined')">Decline</button>
      <button onclick="setStatus('${g.id}','help')">Help</button>
      <button onclick="nextGuest('${g.id}')">Next Guest</button>
    `;
    q.appendChild(div);

    // QR code display only
    if (g.qr_data) {
      new QRious({
        element: document.getElementById(`qr-${g.id}`),
        value: g.qr_data,
        size: 120
      });
    }
  });
}

async function setStatus(id, status) {
  await fetch("/api/update", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ guestId: id, status })
  });
  loadQueue();
}

async function nextGuest(id) {
  await fetch("/api/next", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ guestId: id })
  });
  loadQueue();
}

loadQueue();
setInterval(loadQueue, 3000);
</script>
</body>
</html>
